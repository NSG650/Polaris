name=dbus
version=1.16.2
revision=3
git_url="https://gitlab.freedesktop.org/dbus/dbus.git"
commit=958bf9db2100553bcd2fe2a854e1ebb42e886054
hostdeps="gcc pkg-config"
deps="core-libs libexpat libx11"

configure() {
    meson_configure \
        -Druntime_dir=/run \
        -Dsystemd_system_unitdir=no \
        -Dsystemd_user_unitdir=no \
        -Dsystem_pid_file=/run/dbus/pid \
        -Dsystem_socket=/run/dbus/system_bus_socket \
        -Dselinux=disabled \
        -Dapparmor=disabled \
        -Dlibaudit=disabled \
        -Dkqueue=disabled \
        -Dlaunchd=disabled \
        -Dsystemd=disabled \
        -Dmodular_tests=disabled
}

build() {
    meson compile -j${parallelism}
}

package() {
    DESTDIR="${dest_dir}" meson install --no-rebuild

    touch "${dest_dir}${prefix}"/share/dbus-1/session.d/.keep
    touch "${dest_dir}"/var/lib/dbus/.keep

    post_package_strip
}